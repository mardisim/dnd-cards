import { MigrationInterface, QueryRunner } from "typeorm";

export class Migrations1766054254447 implements MigrationInterface {
    name = 'Migrations1766054254447'

    public async up(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`ALTER TABLE "characters" DROP CONSTRAINT "archetypesId_fkey"`);
        await queryRunner.query(`ALTER TABLE "characters" DROP CONSTRAINT "dndClassesId_fkey"`);
        await queryRunner.query(`ALTER TABLE "characters" DROP CONSTRAINT "usersId_fkey"`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" DROP CONSTRAINT "dndClassesId_fkey"`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" DROP CONSTRAINT "spellsId_fkey"`);
        await queryRunner.query(`ALTER TABLE "spells" DROP CONSTRAINT "schoolId_fkey"`);
        await queryRunner.query(`ALTER TABLE "spells_books" DROP CONSTRAINT "books_spells_booksId_fkey"`);
        await queryRunner.query(`ALTER TABLE "spells_books" DROP CONSTRAINT "books_spells_spellsId_fkey"`);
        await queryRunner.query(`ALTER TABLE "archetypes" DROP CONSTRAINT "booksId_fkey"`);
        await queryRunner.query(`ALTER TABLE "archetypes" DROP CONSTRAINT "dndClassesId_fkey"`);
        await queryRunner.query(`ALTER TABLE "characters_spells" DROP CONSTRAINT "charactersId_fkey"`);
        await queryRunner.query(`ALTER TABLE "characters_spells" DROP CONSTRAINT "spellsId_fkey"`);
        await queryRunner.query(`ALTER TABLE "characters_spells" RENAME COLUMN "spellIsd" TO "spellsId"`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" DROP COLUMN "level"`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" ADD "level" integer`);
        await queryRunner.query(`ALTER TABLE "dnd_classes" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "dnd_classes" ALTER COLUMN "id" SET DEFAULT gen_random_uuid()`);
        await queryRunner.query(`ALTER TABLE "users" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "users" ALTER COLUMN "id" SET DEFAULT gen_random_uuid()`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "id" SET DEFAULT gen_random_uuid()`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "archetypesId" DROP NOT NULL`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "dndClassesId" DROP NOT NULL`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "usersId" DROP NOT NULL`);
        await queryRunner.query(`ALTER TABLE "schools" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "schools" ALTER COLUMN "id" SET DEFAULT gen_random_uuid()`);
        await queryRunner.query(`ALTER TABLE "spells" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "spells" ALTER COLUMN "id" SET DEFAULT gen_random_uuid()`);
        await queryRunner.query(`ALTER TABLE "spells" ALTER COLUMN "schoolsId" DROP NOT NULL`);
        await queryRunner.query(`ALTER TABLE "books" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "books" ALTER COLUMN "id" SET DEFAULT gen_random_uuid()`);
        await queryRunner.query(`ALTER TABLE "archetypes" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "archetypes" ALTER COLUMN "id" SET DEFAULT gen_random_uuid()`);
        await queryRunner.query(`ALTER TABLE "archetypes" ALTER COLUMN "booksId" DROP NOT NULL`);
        await queryRunner.query(`ALTER TABLE "archetypes" ALTER COLUMN "dndClassesId" DROP NOT NULL`);
        await queryRunner.query(`CREATE UNIQUE INDEX "dnd_classes_id_pkey" ON "dnd_classes" ("id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "usersId_pkey" ON "users" ("id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "charactersId_pkey" ON "characters" ("id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "dnd_classes_spells_id_pkey" ON "dnd_classes_spells" ("dndClassesId", "spellsId") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "schoolsId_pkey" ON "schools" ("id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "spells_pkey" ON "spells" ("id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "page_books_spells_pkey" ON "spells_books" ("booksId", "page", "spellsId") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "books_pkey" ON "books" ("id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "archetypes_pkey" ON "archetypes" ("id") `);
        await queryRunner.query(`CREATE INDEX "IDX_d0da33a5c7bafea3a4221e952f" ON "dnd_classes_spells" ("dndClassesId") `);
        await queryRunner.query(`CREATE INDEX "IDX_87a2fb374b8b562cc4cefaa3cd" ON "dnd_classes_spells" ("spellsId") `);
        await queryRunner.query(`CREATE INDEX "IDX_debd94971bf8bbc4340fc66577" ON "characters_spells" ("charactersId") `);
        await queryRunner.query(`CREATE INDEX "IDX_b349ca8d17b789271140c3051a" ON "characters_spells" ("spellsId") `);
        await queryRunner.query(`ALTER TABLE "characters" ADD CONSTRAINT "FK_374c71efb95f0e52819149e055c" FOREIGN KEY ("archetypesId") REFERENCES "archetypes"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "characters" ADD CONSTRAINT "FK_5015958ebd55f7a20f51e429e52" FOREIGN KEY ("dndClassesId") REFERENCES "dnd_classes"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "characters" ADD CONSTRAINT "FK_0e903f80b5b1a97fd1e8fae7a0a" FOREIGN KEY ("usersId") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" ADD CONSTRAINT "FK_d0da33a5c7bafea3a4221e952fc" FOREIGN KEY ("dndClassesId") REFERENCES "dnd_classes"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" ADD CONSTRAINT "FK_87a2fb374b8b562cc4cefaa3cd6" FOREIGN KEY ("spellsId") REFERENCES "spells"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "spells" ADD CONSTRAINT "FK_7bd487fb142ae7c3bfb30132e20" FOREIGN KEY ("schoolsId") REFERENCES "schools"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "spells_books" ADD CONSTRAINT "FK_81ddb45139ac2e237617634128e" FOREIGN KEY ("booksId") REFERENCES "books"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "spells_books" ADD CONSTRAINT "FK_4ae2227467834f193e54c6668be" FOREIGN KEY ("spellsId") REFERENCES "spells"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "archetypes" ADD CONSTRAINT "FK_79ca67145c2484737bcb5d289aa" FOREIGN KEY ("booksId") REFERENCES "books"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "archetypes" ADD CONSTRAINT "FK_4b7cfd003dca07acb0756529ce2" FOREIGN KEY ("dndClassesId") REFERENCES "dnd_classes"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "characters_spells" ADD CONSTRAINT "FK_debd94971bf8bbc4340fc66577b" FOREIGN KEY ("charactersId") REFERENCES "characters"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "characters_spells" ADD CONSTRAINT "FK_b349ca8d17b789271140c3051a1" FOREIGN KEY ("spellsId") REFERENCES "spells"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`ALTER TABLE "characters_spells" DROP CONSTRAINT "FK_b349ca8d17b789271140c3051a1"`);
        await queryRunner.query(`ALTER TABLE "characters_spells" DROP CONSTRAINT "FK_debd94971bf8bbc4340fc66577b"`);
        await queryRunner.query(`ALTER TABLE "archetypes" DROP CONSTRAINT "FK_4b7cfd003dca07acb0756529ce2"`);
        await queryRunner.query(`ALTER TABLE "archetypes" DROP CONSTRAINT "FK_79ca67145c2484737bcb5d289aa"`);
        await queryRunner.query(`ALTER TABLE "spells_books" DROP CONSTRAINT "FK_4ae2227467834f193e54c6668be"`);
        await queryRunner.query(`ALTER TABLE "spells_books" DROP CONSTRAINT "FK_81ddb45139ac2e237617634128e"`);
        await queryRunner.query(`ALTER TABLE "spells" DROP CONSTRAINT "FK_7bd487fb142ae7c3bfb30132e20"`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" DROP CONSTRAINT "FK_87a2fb374b8b562cc4cefaa3cd6"`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" DROP CONSTRAINT "FK_d0da33a5c7bafea3a4221e952fc"`);
        await queryRunner.query(`ALTER TABLE "characters" DROP CONSTRAINT "FK_0e903f80b5b1a97fd1e8fae7a0a"`);
        await queryRunner.query(`ALTER TABLE "characters" DROP CONSTRAINT "FK_5015958ebd55f7a20f51e429e52"`);
        await queryRunner.query(`ALTER TABLE "characters" DROP CONSTRAINT "FK_374c71efb95f0e52819149e055c"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_b349ca8d17b789271140c3051a"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_debd94971bf8bbc4340fc66577"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_87a2fb374b8b562cc4cefaa3cd"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_d0da33a5c7bafea3a4221e952f"`);
        await queryRunner.query(`DROP INDEX "public"."archetypes_pkey"`);
        await queryRunner.query(`DROP INDEX "public"."books_pkey"`);
        await queryRunner.query(`DROP INDEX "public"."page_books_spells_pkey"`);
        await queryRunner.query(`DROP INDEX "public"."spells_pkey"`);
        await queryRunner.query(`DROP INDEX "public"."schoolsId_pkey"`);
        await queryRunner.query(`DROP INDEX "public"."dnd_classes_spells_id_pkey"`);
        await queryRunner.query(`DROP INDEX "public"."charactersId_pkey"`);
        await queryRunner.query(`DROP INDEX "public"."usersId_pkey"`);
        await queryRunner.query(`DROP INDEX "public"."dnd_classes_id_pkey"`);
        await queryRunner.query(`ALTER TABLE "archetypes" ALTER COLUMN "dndClassesId" SET NOT NULL`);
        await queryRunner.query(`ALTER TABLE "archetypes" ALTER COLUMN "booksId" SET NOT NULL`);
        await queryRunner.query(`ALTER TABLE "archetypes" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "archetypes" ALTER COLUMN "id" SET DEFAULT uuid_generate_v4()`);
        await queryRunner.query(`ALTER TABLE "books" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "books" ALTER COLUMN "id" SET DEFAULT uuid_generate_v4()`);
        await queryRunner.query(`ALTER TABLE "spells" ALTER COLUMN "schoolsId" SET NOT NULL`);
        await queryRunner.query(`ALTER TABLE "spells" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "spells" ALTER COLUMN "id" SET DEFAULT uuid_generate_v4()`);
        await queryRunner.query(`ALTER TABLE "schools" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "schools" ALTER COLUMN "id" SET DEFAULT uuid_generate_v4()`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "usersId" SET NOT NULL`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "dndClassesId" SET NOT NULL`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "archetypesId" SET NOT NULL`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "characters" ALTER COLUMN "id" SET DEFAULT uuid_generate_v4()`);
        await queryRunner.query(`ALTER TABLE "users" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "users" ALTER COLUMN "id" SET DEFAULT uuid_generate_v4()`);
        await queryRunner.query(`ALTER TABLE "dnd_classes" ALTER COLUMN "id" DROP DEFAULT`);
        await queryRunner.query(`ALTER TABLE "dnd_classes" ALTER COLUMN "id" SET DEFAULT uuid_generate_v4()`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" DROP COLUMN "level"`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" ADD "level" integer`);
        await queryRunner.query(`ALTER TABLE "characters_spells" RENAME COLUMN "spellsId" TO "spellIsd"`);
        await queryRunner.query(`ALTER TABLE "characters_spells" ADD CONSTRAINT "spellsId_fkey" FOREIGN KEY ("spellIsd", "spellsId") REFERENCES "spells"("id","id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "characters_spells" ADD CONSTRAINT "charactersId_fkey" FOREIGN KEY ("charactersId") REFERENCES "characters"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "archetypes" ADD CONSTRAINT "dndClassesId_fkey" FOREIGN KEY ("dndClassesId", "dndClassesId", "dndClassesId") REFERENCES "dnd_classes"("id","id","id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "archetypes" ADD CONSTRAINT "booksId_fkey" FOREIGN KEY ("booksId") REFERENCES "books"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "spells_books" ADD CONSTRAINT "books_spells_spellsId_fkey" FOREIGN KEY ("spellsId") REFERENCES "spells"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "spells_books" ADD CONSTRAINT "books_spells_booksId_fkey" FOREIGN KEY ("booksId") REFERENCES "books"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "spells" ADD CONSTRAINT "schoolId_fkey" FOREIGN KEY ("schoolsId") REFERENCES "schools"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" ADD CONSTRAINT "spellsId_fkey" FOREIGN KEY ("spellIsd", "spellsId") REFERENCES "spells"("id","id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "dnd_classes_spells" ADD CONSTRAINT "dndClassesId_fkey" FOREIGN KEY ("dndClassesId", "dndClassesId", "dndClassesId") REFERENCES "dnd_classes"("id","id","id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "characters" ADD CONSTRAINT "usersId_fkey" FOREIGN KEY ("usersId") REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "characters" ADD CONSTRAINT "dndClassesId_fkey" FOREIGN KEY ("dndClassesId", "dndClassesId", "dndClassesId") REFERENCES "dnd_classes"("id","id","id") ON DELETE CASCADE ON UPDATE CASCADE`);
        await queryRunner.query(`ALTER TABLE "characters" ADD CONSTRAINT "archetypesId_fkey" FOREIGN KEY ("archetypesId") REFERENCES "archetypes"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
    }

}
